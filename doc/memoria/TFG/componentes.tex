%chapter introduce un nuevo capítulo
\chapter{Elección de componentes}

Como punto de partida, se han seleccionado una serie de componentes adecuados para dotar al robot con las capacidades necesarias para cumplir los objetivos.

\section{Plataforma robótica}

El primer paso para la realización de este proyecto fue el estudio y selección de las plataformas robóticas que pueden conseguirse actualmente. Dado que el objetivo es encontrar un robot humanoide sobre el que se pueda implantar un sistema de visión, es necesario analizar diversos aspectos; algunos mecánicos como el numero y fuerza de los actuadores, y otros electrónicos como la capacidad de procesamiento y velocidad del controlador. Sin embargo, dado que este proyecto es autofinanciado en su mayor medida, el factor económico también es un limitante destacable. 

En el siguiente apartado se presenta un estudio las principales principales opciones.

\subsection{Selección de una plataforma robótica}

En el mercado existe una gran variedad de robots educativos que cumplen las características antropomórficas necesarias para ser considerados robots mini-humanoides. Los robots que se muestran a continuación son una recopilación de algunos de los modelos mas accesibles y extendidos.

\subsubsection{Hitec Robonova}

El Robonova (figura \ref{robonova}) es uno de los mini-humanoides mas extendidos a nivel mundial. Fue uno de los primeros robots de este tipo que se fabricó comercialmente y marcó un antes y un despues en su categoría. Es por esto que es muy común encontrar Robonovas en competiciones como Ceabot, ya que durante muchos años fue el robot mini-humanoide mejor equipado y mas vendido. En la Asociación de Robótica de la Universidad Carlos III, se han utilizado Robonovas en competiciones y proyectos desde su fundación.

\begin{figure}[h]
\centering
\includegraphics[width=0.4\textwidth]{figuras/robonova}   
\caption{Hitec Robonova}
\label{robonova}
\end{figure}

El kit de fábrica cuenta con 16 grados de libertad. Sus actuadores son servos digitales HSR 8498HB, que desarrollan un torque de 7.4kg/cm. Cabe destacar de estor servos su función "Motion Feedback", es decir, su capacidad para leer posiciones y comunicarselas al controlador.
La placa de control del Robonova está basada en un microcontrolador ATMega 128 y cuenta con hasta 40 pines GPIO (puertos binarios de entrada y salida), 8 entradas analógicas, 3 salidas PWM, puerto serie y conexión I2C. Gracias a esto, el Robonova es fácilmente ampliable con sensores y actuadores, no necesariamente de la misma marca. En cuanto al software, Hitec da soporte a la programación con RoboBasic, un entorno de desarrollo completo con un lenguaje basado en Basic. 

\subsubsection{Kondo KHR-3HV}

El KHR-3HV (figura \ref{kondo}), del fabricante japonés Kondo, es uno de los mini-humanoides mas avanzados actualmente. Puede presumir de ser el modelo de serie mas utilizado en el campeonato Robo-One, siendo seleccionado por los equipos por su gran agilidad y tamaño compacto.

\begin{figure}[h]
\centering
\includegraphics[width=0.8\textwidth]{figuras/kondo}   
\caption{Kondo KHR-3HV}
\label{kondo}
\end{figure}

En su configuración standard, el KHR-3HV cuenta con 17 servomotores KRS-2552HV de 14kg/cm de torque. Dichos actuadores, además, incluyen un pequeño microcontrolador, lo que les permite conectarse en daisy chain. El robot incluye una controladora RCB-4, expandible con 10 entradas analogicas y 10 GPIOs, y con capacidad para controlar hasta 35 servos. El software de programación ofrecido por Kondo es el Heart to Heart V4, que puede ser descargado gratuitamente desde su web oficial. Es importante recalcar que gracias a su inmensa comunidad de usuarios, existen varios proyectos de código abierto con librerías que permiten programar el KHR-3HV en lenguajes mas convencionales, como C y Python.


\subsubsection{Vstone Robovie-X}

El Robovie-X, uno de los robots humanoides de la empresa Vstone, se presenta en tres versiones diferentes: Lite, Standard y PRO. La diferencia entre los tres modelos radica en el número y tipo de servos que montan, manteniendo comunes el resto de partes del robot. El modelo Standard (figura \ref{robovie}) posee 17 grados de libertad, movidos por servos VS-S092J que desarrollan un torque de 9.2kg/cm. El controlador es un VS-C1, el cual tiene 30 canales para controlar servos. Vstone también fabrica diversas placas de expansión para la conexión de sensores en el Robovie-X.

\begin{figure}[h]
\centering
\includegraphics[width=0.5\textwidth]{figuras/robovie.jpg}
\caption{Vstone Robovie-X}
\label{robovie}
\end{figure}

Junto al robot se suministra el programa RobovieMaker2, necesario para programarlo. El método de programación está orientado a la construcción de diagramas de flujo desde los que se controlan tanto los movimientos como la lectura de sensores externos.


\subsubsection{Robotis Bioloid}

La empresa koreana Robotis, comercializa un kit robótico conocido como Bioloid. Este kit proporciona una amplia gama de piezas diferentes para montar distintos modelos de robots. La modularidad de los componentes le convierten en una base excelente sobre la que realizar modificaciones, pudiendo diseñar configuraciones alternativas con gran facilidad.

El robot Bioloid (figura \ref{bioloid}) incluye 18 servos Dynamixel, modelo AX-12A o AX-18A, dependiendo de la versión del kit. Los actuadores Dynamixel están controlados internamente por un microcontrolador ATMega8. Gracias a él, estos servos permiten realizar funciones avanzadas tales como el control de velocidad, torque, temperatura de ejecución... etc, posibilitando procesar información de bajo nivel directamente dentro del actuador y pudiendo abstraer el control de la controladora del robot a un nivel superior.

En cuanto a su controladora, los kits proporcionan controladoras de Robotis de la serie CM, mas específicamente, la CM-5 en el caso del Bioloid Comprehensive y la CM-510 o CM-530 (según qué versión) en el Bioloid Premium y GP.


\begin{figure}[h]
\centering
\includegraphics[width=0.4\textwidth]{figuras/bioloid.JPG}   
\caption{Bioloid Premium}
\label{bioloid}
\end{figure}


\begin{itemize}
\item \textbf{Robotis CM-5}.

Cuenta con un microcontrolador ATMega128. Permite la conexión de sensores específicos de la marca en el bus TTL, como el Dynamixel AX-S1.
\item \textbf{Robotis CM-510}.

Basada en un microcontrolador  ATMega2561. Además de los sensores de la propia marca (Dynamixel AX-S1, giróscopo...), que pueden montarse conectados al bus TTL, tiene cinco puertos para la conexión de sensores de salida analógica. Adicionalmente, posee un puerto para conectar un receptor ZigBee y teleoperar el robot.
\item \textbf{Robotis CM-530}.
 
Presentado como la evolución de la CM-510, en este caso el microcontrolador de la placa es un ARM Cortex STM32F103RE, de 32 bits. El resto de características son similares a las de la CM-510, tiene cinco puertos de expasión para sensores analógicos y un puerto para conectar un receptor ZigBee o Bluetooth.
\end{itemize}

En cuanto a la programación, Roboplus ( TODO foto ) es una suite de programas distribuida gratuitamente por Robotis para la programación de sus robots educativos. Destaca por ser un entorno con un lenguaje de programación (R+) muy visual e intuitivo, preparado para su uso por niños o gente sin conocimientos muy avanzados de programación. Sin embargo, esto lo convierte en un lenguaje de programación muy limitado, hasta el punto que no permite utilizar todo el potencial de los actuadores Dynamixel.



\subsubsection{comparativa y elección final TODO}

\section{Modificaciones estructurales}

El Bioloid Comprehensive es un buen punto de partida, sin embargo tiene algunos puntos débiles que conviene revisar. Además, para poder implantar en el robot los dispositivos que requiere este proyecto se necesitará mejorar las capacidades de la plataforma.



\subsection{Cabeza móvil TODO}

Microservo pwm 

\subsection{Cintura móvil TODO}

Servo AX-12A

\section{Elección del controlador TODO}
%mixto
\subsection{Controlador de locomoción TODO}
\subsubsection{Arbotix TODO}
\subsubsection{Serie OpenCM TODO}
\subsection{Controlador de visión TODO}
\subsubsection{BeagleBone Black TODO}
\subsubsection{Raspberry Pi TODO}
\subsubsection{Comparativa y selección TODO}
\section{Sensorización TODO}
%Estudio de diferentes sensores
\subsection{Sensores de distancia TODO}
\subsubsection{Infrarrojos TODO}
\subsubsection{Ultrasonidos TODO}
\subsection{Sensores inerciales TODO}

El control del equilibrio del robot es muy importante en configuraciones bípedas, ya que estos robots son conocidos por su facilidad para tropezar y caer al suelo. Con el objetivo de analizar la posición del robot respecto al suelo se ha requerido la inclusión de un sensor inercial.

\subsubsection{Brújula}
\subsubsection{Girsocopio TODO}
\subsubsection{Acelerómetro TODO}


% TODO cambiar por foto real
\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{figuras/imu}   
\caption{Sensor inercial MPU9150}
\label{imu}
\end{figure}

En el mercado existen varios modelos económicos. En este proyecto se ha utilizado un sensor MPU9150 (figura \ref{imu}), que es un sensor inercial compuesto de acelerómetro de 3 ejes, giroscopio de 3 ejes y brújula de 3 ejes. Este sensor combina dos sensores, un MPU6050 (incluye el acelerometro y el giroscopio) y un AK8975 (incluye la brújula).


\subsection{Cámara TODO}

La elección de la cámara ha sido condicionada principalmente por su compatibilidad con el driver de Linux v4l2. Existe una amplia variedad de cámaras válidas en el mercado. Dado el carácter de este proyecto, se ha optado por utilizar una webcam, ya que son mas accesibles que las cámaras avanzadas de investigación y los algoritmos de visión que serán programados no requieren imágenes de alta calidad.

\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{figuras/camara}   
\caption{Microsoft LifeCam Cinema}
\label{camara}
\end{figure}

El modelo selecionado ha sido una Microsoft LifeCam Cinema (figura \ref{camara}). Entre sus carácterísticas destacan su posibilidad de grabar video en 720p HD, enfoque automático y la regulación de brillos en tiempo real. Adicionalmente, se trata de una cámara de fácil desmontaje y dimensiones contenidas, por lo que será sencillo integrarla en el robot.

Cabe remarcar que antes de utilizar esta cámara se realizaron pruebas con una Hama Pocket, pero dada su baja calidad de construcción presentó diversos problemas de fiabilidad y fue despreciada en favor de la Microsoft. 

\section{Alimentación TODO}

La batería contenida en el kit está compuesta es una batería NiMH de 8 elementos AA Sanyo Eneloop que desarrolla 9.6 voltios y 1900 mAh. Para el consumo de este robot es una opción aceptable que proporciona cerca de 10 minutos de autonomía. No está mal si se tiene en cuenta que pruebas con el CEABOT tiene una duración máxima limitada a 5 minutos. Sin embargo tiene un inconveniente, su peso y su volumen es muy alto, y al estar situado en la espalda, sube el centro de gravedad del robot de forma considerable. Esto causa inestabilidad en el robot y complica bastante la programación de desplazamientos.

\subsection{Batería}

Por las razones descritas, se ha decidido buscar una alternativa. Los requísitos para seleccionar una batería los marcan tres factores: La tensión de funcionamiento de los servos, la de las placas de control y la de los sensores. Pero dado que los servos tienen una tensión de operación en un rango de 9 a 12 voltios, respecto al resto de elementos que serán alimentados a 5 o 3.3 voltios, nos centraremos principalmente en encontrar una batería adecuada para los servos.

Hoy en dia, las baterías ne NiMH están empezando a caer en desuso a favor de la baterías de litio. Se barajaron dos posibilidades.

% TODO al final de la sección se debe calcular la autonomía del robot

\subsubsection{Baterías de polímero de litio}

Las baterías de polímero de litio, mas conocidas como baterías LiPo, destacan por desarrollar una tasa de descarga bastante alta y por tener un tamaño y peso reducido. Dado su uso en automodelismo y aeromodelismo, son unas baterías muy comunes que en los últimos años han ido bajando su precio. Actualmente existe una gran variedad de baterías LiPo de diversos tamaños y precio asequible. Cada célula LiPo ofrece 3.7 voltios, por lo que la elección correcta para este robot sería una batería de 3S, o lo que es lo mismo, 11,1 voltios. Sin embargo, las baterías LiPo tienen una desventaja importante, su fragilidad. El proceso de carga y descarga de una batería de este tipo no es un asunto trivial, una sobredescarga de la batería provoca un deterioro inmediato de la misma, calentando sus elementos e incluso pudiendo llegar a incendiarse. Es por ello que se necesita un cargador con capacidad para balancear las células, de forma que las tensiones de cada una de ellas se tengan bajo control durante el proceso.

\subsubsection{Baterías de litio fosfato de hierro}  

Las batería de litio fosfato de hierro, es decir, LiFe, son conocidas por su gran resistencia y larga vida útil. Cada célula de LiFe desarrolla 3.3 voltios y no presenta problemas por sobredescargas. De hecho, estas baterías ni siquiera requieren de un cargador balanceador para su carga, sino que pueden cargarse sin problemas con un cargador normal. El gran problema de estas baterías es que sus elementos son bastante voluminosos, y, al no ser tan populares como las LiPo, tampoco es demasiado fácil encontrar modelos de tamaño y capacidad adecuados en el mercado. 

\subsubsection{Elección y diseño del sistema}  

Por su tamaño y prestaciones se ha elegido una batería LiPo Rhino de 3S y 1750mAh. Esta batería tiene unas dimensiones perfectas para montarse en la cintura del robot y su peso es 50 ( TODO pesarla, que ahora no la tengo a mano ) gramos menor al de la batería original (215 gramos). 

A continuación se presenta una tabla (cuadro \ref{consumo}) con una estimación de la autonomía del robot basada en el consumo medio de todos sus elementos por separado.

% TODO foto de la batería

\begin{table}[H]
\centering
\begin{tabular}{ >{\arraybackslash}m{2cm} >{\centering\arraybackslash}m{1.3cm}  >{\arraybackslash}m{5cm}  >{\arraybackslash}m{3cm}}
\hline
Dispositivo & Número & Consumo unitario & Consumo total  \\
\hline \hline
Dynamixel AX-12A & x19 & $11.1V\cdot600mA=6660mW$ & $126540mW$ \\ \hline
Tower Pro MG90s & x1 & $5V\cdot120mA=600mW$ & $600mW$ \\ \hline
BeagleBone Black & x1 & $5V\cdot1200mA=6000mW$ & $6000mW$ \\ \hline
OpenCM 9.04 & x1 & $11.1V\cdot90mA\simeq1000mW$ & $1000mW$ \\ \hline
Sharp IR & x2 & $5V\cdot30mA=150mW$ & $300mW$ \\ \hline
MPU9150 & x1 & $3.3V\cdot15mA\simeq50mW$ & $50mW$ \\ \hline
HMC5883L &  x1  &  $3.3V\cdot12mA\simeq40mW$ & $40mW$ \\ \hline
Microsoft LifeCam & x1  &  $5V\cdot200mA=1000mW$ &  $1000mW$ \\ \hline \hline 
\medskip Total &  &  & \medskip $135530mW\simeq136W$  \\ \hline
\hline
\end{tabular}
\caption{Consumo medio}
\label{consumo}
\end{table}

Por tanto, la estimación de autonomía del robot en funcionamiento es la siguiente:
\[ \dfrac{11.1V\cdot1750mAh}{135530mW}\cdot\dfrac{60min}{h}\simeq8.6min\]

Entre 8 y 9 minutos de autonomía teóricos es un buena cifra contando con el tamaño del robot y sus prestaciones. Como conclusión podemos remarcar el hecho de que gracias al nuevo sistema de alimentación hemos podido introducir los dispositivos necesarios para cumplir los requerimientos de este proyecto sin comprometer la autonomía del robot.

\subsection{Regulador de tensión TODO }

Hasta aquí parece que es suficiente con la elección de la nueva batería, sin embargo, aún falta un detalle que deberemos resolver. La mayor parte de los dispositivos que forman el conjunto están alimentados a 5 voltios. La batería que hemos elegido tiene una tensión de 11.1 voltios, y se ha observado, que cuando está cargada al máximo desarrolla hasta 12.6 voltios. No podemos alimentar la BeagleBone Black y el resto de componentes a una tensión tan alta, por lo que será necesario colocar un regulador que nos proporcione 5 voltios.

\subsubsection{Regulador lineal TODO }

La primera idea fue utilizar un pequeño circuito con un regulador lineal LM7805 (figura \ref{7805}). El LM7805 es un componente muy común en los circuitos electrónicos, ya que ofrecen una salida de 5 voltios a partir de tensiones de entrada de hasta 35 voltios. En principio no parecería muy descabellado conectar los servos AX-12A  y la placa OpenCM directamente a la batería, y conectar en resto de componentes a través del regulador.

[FOTO DE UN REGULADOR]

No obstante existen dos problemas para realizar este montaje. El primero es que la eficiencia de este componente es muy pobre, cercana al 60\% según su hoja de características. Esto provocaría una disminución drástica en el tiempo de operación del robot y una disipación de energia tan alta que sería necesario incluir un disipador. Pero el segundo problema es mas importante, el componente está diseñado para aportar una corriente máxima al circuito de 1 amperio. Teniendo en cuenta los datos del cuadro \ref{consumo}, solo la BeagleBone Black ya requiere una corriente de 1.2 amperios, y junto al resto de componentes, asciende hasta 1.7 amperios . Un consumo superior al marcado por el fabricante puede producir fallos de funcionamiento en el componente. En este caso particular, podría producirse un calentamiento excesivo, que a su vez puede llegar a provocar cortocircuitos internos entre la patilla de entrada y la de salida. Las consecuencias de un fallo así serían nefastas, ya que deteriorarían los dispositivos conectados a él.

\subsubsection{Convertidor UBEC TODO }

Un UBEC (figura \ref{ubec}) es un convertidor DC-DC de tipo reductor. Los UBEC se utilizan normalmente con baterías de litio cuando el sistema necesita una tensión de alimentación de 5 o 6 voltios. Es por ello que se utilizan mucho en receptores de emisoras de radiocontrol, y gracias a esto existe una amplia variedad de UBECs asequibles en el mercado. La mayor ventaja de estos circuitos convertidores es su eficiencia superior al 90\%. Gracias a esto nuestro sistema tebndrá unas perdidas menores, no se calentará en exceso y gozará de una autonomía mayor. 

[FOTO DE UBEC]

\subsubsection{Elección final}

Tal y como se comentaba anteriormente, nuestro sistema tiene un consumo estimado de unos 1.7 amperios en la salida de 5 voltios, por lo que un UBEC de 3 amperios sería suficiente para proporcionar al circuito la corriente necesaria para su funcionamiento. Adicionalmente se han incluido unos condensadores en la entrada y salida del circuito para ... como ser verá en el apartado ( TODO )

\paragraph{Palabras clave:} palabraclave1, palabraclave2, palabraclave3.
